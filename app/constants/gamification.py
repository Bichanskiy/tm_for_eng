from dataclasses import dataclass
from typing import Dict, List
import random


@dataclass
class Achievement:
    id: str
    name: str
    description: str
    icon: str
    xp_reward: int


# –í—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
ACHIEVEMENTS: Dict[str, Achievement] = {
    # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ –∑–∞–¥–∞—á–∏
    "first_task": Achievement(
        id="first_task",
        name="–ü–µ—Ä–≤—ã–π —à–∞–≥",
        description="–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É",
        icon="üéØ",
        xp_reward=10
    ),
    "task_master_10": Achievement(
        id="task_master_10",
        name="–ù–æ–≤–∏—á–æ–∫",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ 10 –∑–∞–¥–∞—á",
        icon="‚≠ê",
        xp_reward=50
    ),
    "task_master_50": Achievement(
        id="task_master_50",
        name="–û–ø—ã—Ç–Ω—ã–π",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ 50 –∑–∞–¥–∞—á",
        icon="üåü",
        xp_reward=150
    ),
    "task_master_100": Achievement(
        id="task_master_100",
        name="–ú–∞—Å—Ç–µ—Ä –∑–∞–¥–∞—á",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ 100 –∑–∞–¥–∞—á",
        icon="üí´",
        xp_reward=300
    ),
    "task_master_500": Achievement(
        id="task_master_500",
        name="–õ–µ–≥–µ–Ω–¥–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ 500 –∑–∞–¥–∞—á",
        icon="üèÜ",
        xp_reward=1000
    ),

    # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ —Å—Ç—Ä–∏–∫–∏
    "streak_3": Achievement(
        id="streak_3",
        name="–¢—Ä–∏ –¥–Ω—è –ø–æ–¥—Ä—è–¥",
        description="–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞—á–∏ 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥",
        icon="üî•",
        xp_reward=30
    ),
    "streak_7": Achievement(
        id="streak_7",
        name="–ù–µ–¥–µ–ª—è –æ–≥–Ω—è",
        description="–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞—á–∏ 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥",
        icon="üî•üî•",
        xp_reward=100
    ),
    "streak_30": Achievement(
        id="streak_30",
        name="–ú–µ—Å—è—Ü –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
        description="–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞—á–∏ 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥",
        icon="üî•üî•üî•",
        xp_reward=500
    ),
    "streak_100": Achievement(
        id="streak_100",
        name="–°—Ç–æ–¥–Ω–µ–≤–∫–∞",
        description="–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞—á–∏ 100 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥",
        icon="üíé",
        xp_reward=2000
    ),

    # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã
    "high_priority": Achievement(
        id="high_priority",
        name="–í–∞–∂–Ω—ã–µ –¥–µ–ª–∞",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º 10",
        icon="üéñÔ∏è",
        xp_reward=25
    ),

    # –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ —É—Ä–æ–≤–Ω–∏
    "level_5": Achievement(
        id="level_5",
        name="–£—Ä–æ–≤–µ–Ω—å 5",
        description="–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 5 —É—Ä–æ–≤–Ω—è",
        icon="üìà",
        xp_reward=0  # –ù–∞–≥—Ä–∞–¥–∞ —É–∂–µ –≤ —É—Ä–æ–≤–Ω–µ
    ),
    "level_10": Achievement(
        id="level_10",
        name="–£—Ä–æ–≤–µ–Ω—å 10",
        description="–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 10 —É—Ä–æ–≤–Ω—è",
        icon="üìä",
        xp_reward=0
    ),
    "level_25": Achievement(
        id="level_25",
        name="–£—Ä–æ–≤–µ–Ω—å 25",
        description="–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ 25 —É—Ä–æ–≤–Ω—è",
        icon="üöÄ",
        xp_reward=0
    ),

    # –û—Å–æ–±—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    "early_bird": Achievement(
        id="early_bird",
        name="–†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–æ 7 —É—Ç—Ä–∞",
        icon="üåÖ",
        xp_reward=40
    ),
    "night_owl": Achievement(
        id="night_owl",
        name="–ù–æ—á–Ω–∞—è —Å–æ–≤–∞",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É –ø–æ—Å–ª–µ –ø–æ–ª—É–Ω–æ—á–∏",
        icon="ü¶â",
        xp_reward=40
    ),
    "speed_demon": Achievement(
        id="speed_demon",
        name="–°–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –¥–µ–º–æ–Ω",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ 5 –∑–∞–¥–∞—á –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å",
        icon="‚ö°",
        xp_reward=75
    ),
    "perfectionist": Achievement(
        id="perfectionist",
        name="–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞",
        icon="‚ú®",
        xp_reward=20
    ),
    "no_procrastination": Achievement(
        id="no_procrastination",
        name="–ë–µ–∑ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏",
        description="–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É –≤ –¥–µ–Ω—å —Å–æ–∑–¥–∞–Ω–∏—è",
        icon="üí™",
        xp_reward=35
    ),
}

# –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏
COMPLETION_PHRASES = [
    "üéâ –û—Ç–ª–∏—á–Ω–æ! –¢–∞–∫ –¥–µ—Ä–∂–∞—Ç—å!",
    "üí™ –ú–æ–ª–æ–¥–µ—Ü! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!",
    "üåü –°—É–ø–µ—Ä! –¢—ã —Å–ø—Ä–∞–≤–∏–ª—Å—è!",
    "üöÄ –í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ! –ï—â—ë –æ–¥–∏–Ω —à–∞–≥ –∫ —Ü–µ–ª–∏!",
    "‚ú® –ü—Ä–µ–∫—Ä–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞!",
    "üî• –¢—ã –≤ —É–¥–∞—Ä–µ! –ü—Ä–æ–¥–æ–ª–∂–∞–π!",
    "üëè –ë—Ä–∞–≤–æ! –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!",
    "üí´ –ó–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü!",
    "üèÜ –ü–æ–±–µ–¥–∞! –ó–∞–¥–∞—á–∞ –ø–æ–±–µ–∂–¥–µ–Ω–∞!",
    "‚≠ê –ë–ª–µ—Å—Ç—è—â–µ! –¢—ã —Å–ø—Ä–∞–≤–ª—è–µ—à—å—Å—è!",
    "üéØ –¢–æ—á–Ω–æ –≤ —Ü–µ–ª—å! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!",
    "üíé –ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ!",
    "üåà –ß—É–¥–µ—Å–Ω–æ! –ú–∏—Ä —Å—Ç–∞–ª –ª—É—á—à–µ!",
    "ü¶∏ –¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –≥–µ—Ä–æ–π –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!",
    "üéä –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞! –ï—â—ë –æ–¥–Ω–∞ –ø–æ–±–µ–¥–∞!",
]

# –§—Ä–∞–∑—ã –¥–ª—è —Å—Ç—Ä–∏–∫–æ–≤
STREAK_PHRASES = {
    3: "üî• 3 –¥–Ω—è –ø–æ–¥—Ä—è–¥! –û—Ç–ª–∏—á–Ω—ã–π —Å—Ç–∞—Ä—Ç!",
    5: "üî• 5 –¥–Ω–µ–π! –¢—ã –Ω–∞–±–∏—Ä–∞–µ—à—å –æ–±–æ—Ä–æ—Ç—ã!",
    7: "üî•üî• –ù–µ–¥–µ–ª—è! –¢—ã –Ω–µ—É–¥–µ—Ä–∂–∏–º!",
    14: "üî•üî• 2 –Ω–µ–¥–µ–ª–∏ –ø–æ–¥—Ä—è–¥! –í–ø–µ—á–∞—Ç–ª—è–µ—Ç!",
    21: "üî•üî• 21 –¥–µ–Ω—å! –≠—Ç–æ —É–∂–µ –ø—Ä–∏–≤—ã—á–∫–∞!",
    30: "üî•üî•üî• –ú–µ—Å—è—Ü! –¢—ã –ª–µ–≥–µ–Ω–¥–∞!",
    50: "üî•üî•üî• 50 –¥–Ω–µ–π! –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ!",
    100: "üíéüî•üíé 100 –î–ù–ï–ô! –¢–´ –ê–ë–°–û–õ–Æ–¢–ù–´–ô –ß–ï–ú–ü–ò–û–ù!",
}

# –§—Ä–∞–∑—ã –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å—Ç—Ä–∏–∫–∞
STREAK_LOST_PHRASES = [
    "üò¢ –°—Ç—Ä–∏–∫ –ø–æ—Ç–µ—Ä—è–Ω... –ù–æ –Ω–∏—á–µ–≥–æ, –Ω–∞—á–Ω—ë–º –∑–∞–Ω–æ–≤–æ!",
    "üíî –°—Ç—Ä–∏–∫ —Å–±—Ä–æ—à–µ–Ω. –ù–æ–≤—ã–π –¥–µ–Ω—å - –Ω–æ–≤—ã–π —Å—Ç–∞—Ä—Ç!",
    "üîÑ –°—Ç—Ä–∏–∫ –æ–±–Ω—É–ª–∏–ª—Å—è. –í—Ä–µ–º—è –ø–æ–±–∏—Ç—å —Å–≤–æ–π —Ä–µ–∫–æ—Ä–¥!",
    "üìâ –°—Ç—Ä–∏–∫ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è. –í–ø–µ—Ä—ë–¥ –∫ –Ω–æ–≤—ã–º –≤–µ—Ä—à–∏–Ω–∞–º!",
]

# –§—Ä–∞–∑—ã –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–µ–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏
MORNING_MOTIVATION = [
    "üåÖ –î–æ–±—Ä–æ–µ —É—Ç—Ä–æ! –°–µ–≥–æ–¥–Ω—è –æ—Ç–ª–∏—á–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏!",
    "‚òÄÔ∏è –ù–æ–≤—ã–π –¥–µ–Ω—å - –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏! –ü–æ–≥–Ω–∞–ª–∏!",
    "üåÑ –£—Ç—Ä–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø–æ–±–µ–¥! –ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ–∫–æ—Ä–∏–º —Å–µ–≥–æ–¥–Ω—è?",
    "üåû –ü—Ä–∏–≤–µ—Ç! –ì–æ—Ç–æ–≤ —Å–≤–µ—Ä–Ω—É—Ç—å –≥–æ—Ä—ã —Å–µ–≥–æ–¥–Ω—è?",
    "üåª –û—Ç–ª–∏—á–Ω–æ–≥–æ –¥–Ω—è! –ü—É—Å—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç –ø–æ –ø–ª–µ—á—É!",
]


# –£—Ä–æ–≤–Ω–∏ –∏ —Ç—Ä–µ–±—É–µ–º—ã–π XP
def get_xp_for_level(level: int) -> int:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç XP, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è"""
    return int(100 * (level ** 1.5))


def get_level_from_xp(xp: int) -> int:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É XP"""
    level = 1
    while get_xp_for_level(level + 1) <= xp:
        level += 1
    return level


# –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
def get_task_xp(priority: int, is_on_time: bool, is_same_day: bool) -> int:
    """–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç XP –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏"""
    base_xp = 10
    priority_bonus = priority * 2  # –û—Ç 2 –¥–æ 20 XP –∑–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    time_bonus = 15 if is_on_time else 0  # –ë–æ–Ω—É—Å –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–≤—Ä–µ–º—è
    speed_bonus = 10 if is_same_day else 0  # –ë–æ–Ω—É—Å –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –¥–µ–Ω—å —Å–æ–∑–¥–∞–Ω–∏—è

    return base_xp + priority_bonus + time_bonus + speed_bonus


def get_random_completion_phrase() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏"""
    return random.choice(COMPLETION_PHRASES)


def get_streak_phrase(streak: int) -> str | None:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—Ä–∞–∑—É –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Å—Ç—Ä–∏–∫–∞"""
    return STREAK_PHRASES.get(streak)


def get_random_morning_phrase() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —É—Ç—Ä–µ–Ω–Ω—é—é —Ñ—Ä–∞–∑—É"""
    return random.choice(MORNING_MOTIVATION)


def get_random_streak_lost_phrase() -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é —Ñ—Ä–∞–∑—É –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å—Ç—Ä–∏–∫–∞"""
    return random.choice(STREAK_LOST_PHRASES)


# –≠–º–æ–¥–∑–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π
def get_level_emoji(level: int) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç–º–æ–¥–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è"""
    if level >= 50:
        return "üëë"
    elif level >= 25:
        return "üíé"
    elif level >= 15:
        return "üèÜ"
    elif level >= 10:
        return "ü•á"
    elif level >= 5:
        return "ü•à"
    else:
        return "ü•â"


# –¢–∏—Ç—É–ª—ã –ø–æ —É—Ä–æ–≤–Ω—è–º
def get_title(level: int) -> str:
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏—Ç—É–ª –ø–æ —É—Ä–æ–≤–Ω—é"""
    titles = {
        1: "–ù–æ–≤–∏—á–æ–∫",
        5: "–£—á–µ–Ω–∏–∫",
        10: "–ü—Ä–∞–∫—Ç–∏–∫",
        15: "–ú–∞—Å—Ç–µ—Ä",
        20: "–≠–∫—Å–ø–µ—Ä—Ç",
        25: "–ì—É—Ä—É",
        30: "–°–µ–Ω—Å–µ–π",
        40: "–õ–µ–≥–µ–Ω–¥–∞",
        50: "–ë–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏",
    }

    for lvl in sorted(titles.keys(), reverse=True):
        if level >= lvl:
            return titles[lvl]
    return "–ù–æ–≤–∏—á–æ–∫"